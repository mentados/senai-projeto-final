var _cartstack=_cartstack||[];var cs_call=false;var cs_event='capture';var cs_debug=cs_debug||false;var cs_pro=cs_pro||false;var cs_pro_hit=cs_pro_hit||false;var cs_api_host='https://api2.cartstack.com.br';var cs_cart_limit=10;var cs_api_urls={purchase:cs_api_host+'/br/php/purchase.php',cart:cs_api_host+'/php/cart.php',cart_update:cs_api_host+'/br/php/cart_update.php',browse:cs_api_host+'/br/php/browse.php'};var dmregExp=/([a-z\-0-9]{2,63})\.([a-z\.]{2,6})$/;function cs_cartItems(){var b=0;if("undefined"!=typeof _cartstack)
for(var a=0;a<_cartstack.length;a++)"setCartItem"==_cartstack[a][0]&&b++;return b}
function cs_cartItemsLimit(arr){cs_cart_limit=xe_isset(cs_cart_limit,'number')?cs_cart_limit:10;var b=0;var rem=[];arr=("undefined"==typeof arr)?_cartstack:arr;for(var a=0;a<arr.length;a++){if("setCartItem"==arr[a][0]){b++;b>cs_cart_limit&&rem.push(a);}}
if(rem.length>0){for(var a=0;a<rem.length;a++)
arr.splice(rem[a],1);}
return arr;}
function cs_browseItemsDup(arr){var b=0;var rem=[];arr=("undefined"==typeof arr)?_cartstack_pro:arr;if("undefined"!=typeof arr){for(var a=0;a<arr.length;a++){if("setBrowseItem"==arr[a][0]){b++;b>10&&rem.push(a);}}
if(rem.length>0){for(var a=0;a<rem.length;a++)
arr.splice(rem[a],1);}}
return arr;}
function cs_fullUTMURL(arr,utm){arr=('undefined'==typeof arr)?_cartstack:arr;utm=('undefined'==typeof utm||'object'!=typeof utm)?{source:'CartStack',medium:'Email',campaign:'CarrinhoAbandonado'}:utm;var url=window.location.href;var part='utm_source='+utm.source+'&utm_medium='+utm.medium+'&utm_campaign='+utm.campaign;var _arr=[];for(var key in xe_urlp){if(xe_urlp.hasOwnProperty(key)){_arr.push(key+'='+xe_urlp[key]);}}
if(_arr.length>0)
part=part+'&'+_arr.join('&');part=(url.indexOf('#')>-1&&part.indexOf('#')==-1)?part+'#'+url.split('#')[1]:part;url=url.split('?')[0]+'?'+part;var added=false;for(var a=0;a<arr.length;a++){added=(added||("setDataItem"==arr[a][0]&&typeof arr[a][1]=='object'&&typeof arr[a][1].FullURL=='string'))?true:false;}
if(!added){arr.push(['setDataItem',{'FullURL':url}]);}
return url;}
function cartstack_getCookie(t){return xe_readCookie(t.split('=')[0],true);}
function cs_lgpdRestrict(){var lgpd_restrict=xe_core.callService('cookieConsent');lgpd_restrict=(lgpd_restrict==='DENY'||(lgpd_restrict!=''&&lgpd_restrict.indexOf('EMAIL_MARKETING')==-1))?true:false;if(!lgpd_restrict){_cartstack.push(['xe_visitorID',xe_core.callService('visitorInfo').id]);}
return lgpd_restrict;}
function csAPICall(api_url,callback){if(cs_lgpdRestrict()){return false;}
cs_cartItemsLimit();var x=new XMLHttpRequest,N="cartstack_data="+encodeURIComponent(JSON.stringify(_cartstack));if(x.open("POST",api_url,!0),x.setRequestHeader("Content-type","application/x-www-form-urlencoded"),x.onreadystatechange=function(){if(4==x.readyState){if(200==x.status){var t=(x.responseText.indexOf('{"')>-1)?JSON.parse(x.responseText):false;(t!==false&&typeof callback=='function')?callback(t,200):callback(false,200);}else
(typeof callback=='function')&&callback(false,x.status);}},x.send(N));}
function cartstackCall(){if(cs_call){return false;}
cs_call=true;cs_debug&&console.log("cartstackCall();");var t=/^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;if("undefined"!=typeof _cartstack&&!cartstack_confirmation){var e="",a=0,r=window.location.href;(r.indexOf("cartstacktest=true")>-1||xe_readCookie('cs_debug')!='')&&(a=1,_cartstack.push(["setShowAlert",1]));_cartstack.push(["setReferringURL",r]);for(var c=0,s=0,i="",o="",n="",d="",l=0;l<_cartstack.length;l++){var m=_cartstack[l][0],p=_cartstack[l][1];"setAPI"==m&&"capture"==p&&(s=1),"setAPI"==m&&"confirmation"==p&&(cartstack_confirmation=1),"setAPI"==m&&"tracking"==p&&(c=1),"setEmail"==m&&(i=p),"setSiteID"==m&&(o=p),"setEmailAddressInput"==m&&(n=p),"setDomain"==m&&(d=p),"setCartID"==m&&(e=p)}
if(0==d.length){var parts;var d=window.location.hostname;if((parts=dmregExp.exec(d))!==null){if(parts.index===dmregExp.lastIndex)
dmregExp.lastIndex++;d=(!parts[0]||parts[0]=='undefined')?-1:String(parts[0]);}}
if(navigator.cookieEnabled===!0){var k=r.indexOf("cs_e_id=");if(k>-1){k+=8;var g=r.indexOf("&",k);i=g>-1?r.substring(k,g):r.substring(k),i=decodeURIComponent(i)}
if(r.indexOf("_cscid=")>-1){var f;f=r.split("_cscid=")[1],e=f.indexOf("&")>-1?f.split("&")[0]:f}
var eml=xe_core.callService('visitorInfo').email,cid=xe_readCookie('cartstack.com-cartid');if(isNaN(cid)){cid='';xe_deleteCookie('cartstack.com-cartid');}
if(s&&!c){cs_event='capture';cs_debug&&console.log('CartStack: Capture!');}else
if(cartstack_confirmation){cs_event='confirmation';cs_debug&&console.log("CartStack Event: Confirmation");if(eml!=''){for(var A=1,B=1,l=0;l<_cartstack.length;l++){"setEmail"==_cartstack[l][0]&&(_cartstack[l][1]=eml,A=0);"setCartID"==_cartstack[l][0]&&(_cartstack[l][1]=cid,B=0);}
A&&_cartstack.push(["setEmail",eml]);(B&&cid!='')&&_cartstack.push(["setCartID",cid]);csAPICall(cs_api_urls.purchase,function(json,httpcode){if(httpcode==200){xe_deleteCookie('cartstack.com-cartid');cs_debug&&console.log('CartStack: Email removed from queue');}else
cs_debug&&console.log('CartStack: Cart API Failed!');});}}else{cs_event='checkout';cs_debug&&console.log('CartStack: Cart/Checkout!');if(eml!=''){for(var C=1,l=0;l<_cartstack.length;l++)
"setEmail"==_cartstack[l][0]&&(_cartstack[l][1]=eml,C=0);C&&_cartstack.push(["setEmail",eml]),cid!=''&&_cartstack.push(["setCartID",cid]);}else
cs_debug&&console.log('CartStack: No email found to track');csAPICall(cs_api_urls.cart,function(json,httpcode){if(json!==false){for(var e=0;e<_cartstack.length;e++)"setCartID"==_cartstack[e][0]&&(_cartstack[e][1]=json.cartid);xe_createCookie('cartstack.com-cartid',json.cartid,365,true);cs_debug&&alert(json.debug);}else
cs_debug&&console.log('CartStack: Cart API Failed!');});}}else cs_debug&&alert("Cookies not enabled!")}}
function cartstack_updatecart(t){t.push(["setLocation","br"]);var e=!1,a=0,r=0,o="",i=0,n=window.location.href;cs_debug&&console.log("cartstack_updatecart();");n.indexOf("cartstacktest=true")>-1&&(i=1,t.push(["setShowAlert",1]),e=!0),t.push(["setReferringURL",n]),t.push(["setBrowserOSDetails",navigator.userAgent]);for(var s=0;s<t.length;s++){var c=t[s][0],p=t[s][1];"setDomain"==c&&(o=p),"setAPI"==c&&"confirmation"==p&&(r=1),"setEmail"==c&&(a=1)}
if(0==o.length){var d=window.location.hostname,l=d.split(".");if(l.length>=3)
for(var s=1;s<l.length;s++)o=0==o.length?l[s]:o+"."+l[s];else o=l.length>=2?l[0]+"."+l[1]:l[0]}
if(navigator.cookieEnabled===!0){var m=cartstack_getCookie("cartstack.com-cartid=");var eml=xe_core.callService('visitorInfo').email;eml=(xe_core.callService('cookieConsent')=='DENY')?'':eml;if(e&&alert('CartID from Cookie: "'+m+'"'),t.push(["setCartID",m]),a||(cartstack_update_email=eml,e&&alert('Email from Cookie: "'+cartstack_update_email+'"'),cartstack_update_email.length>0&&t.push(["setEmail",cartstack_update_email])),r){var h=new XMLHttpRequest,u="cartstack_data="+encodeURIComponent(JSON.stringify(t));e&&alert("Confirmation!! -> "+u),h.open("POST",cs_api_urls.purchase,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){xe_deleteCookie('cartstack.com-cartid');e&&alert("CartID Cookie erased!");}},h.send(u),e&&alert("Confirmation Sent to the server!")}else if(!cs_lgpdRestrict()){t=cs_cartItemsLimit(t);var h=new XMLHttpRequest,u="cartstack_data="+encodeURIComponent(JSON.stringify(t));h.open("POST",cs_api_urls.cart_update,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.onreadystatechange=function(){if(4==h.readyState&&200==h.status){var t=JSON.parse(h.responseText);cs_debug&&alert(t.debug);xe_createCookie('cartstack.com-cartid',t.cartid,365,true);}},h.send(u)}}else i&&alert("Cookies not enabled!")}
var cartstack_confirmation=cartstack_confirmation||0;