function baseurl(t){return myurl=window.location,splited_url=myurl.toString().split("/"),final_url=splited_url[0]+"//"+splited_url[2],islocalhost(document.location.hostname)?final_url=splited_url[0]+"//"+splited_url[2]+"/"+splited_url[3]:final_url=splited_url[0]+"//"+splited_url[2],final_url+"/"+t}function islocalhost(t){if("localhost"==t)return!0;exploded=t.split(".");for(var e=0;e<exploded.length;e++)if(isNaN(exploded[e]))return!1;return!0}jQuery(document).ready(function(){function t(t,e,o,r){return'<option id="'+t+'" compra="'+e+'"  value="'+o+'">'+r+"</option>"}jQuery(".btnadd").click(function(t){len=jQuery(this).closest(".opcoes").find(".selectAttr").length,form=jQuery(this).closest(".formcomprejunto"),submit=!0,len>0?jQuery(this).closest(".opcoes").find(".selectAttr").each(function(t,e){valor=jQuery(this).find("option:checked").val(),""==valor?(jQuery(this).css("border","1px dashed red"),jQuery(".attribute-error-msg").addClass("show").text("Selecione uma opção para prosseguir."),submit=!1):null==valor?(jQuery(this).closest(".product").find(".selectAttr").val("").css("border","1px dashed red"),jQuery(".attribute-error-msg").addClass("show").text("Selecione uma opção para prosseguir."),submit=!1):(jQuery(this).css("border","none"),jQuery(".attribute-error-msg.show").removeClass("show").text("")),t==len-1&&submit&&jQuery(form).submit()}):jQuery(form).submit()}),jQuery('.selectAttr[class*="attr_"]').change(function(){produto=jQuery(this).closest(".product"),product_id=jQuery(this).closest(".product").attr("id"),jQuery(produto).find(".loadingattr").show(),jQuery(produto).css("opacity","0.30"),select_atual=jQuery(this),jQuery(this).find("option:selected").each(function(){id_compra=jQuery(this).attr("compra")}),key=(parseInt(jQuery(this).attr("key"))+1).toString(),next_attribute=jQuery(".product_"+product_id+".select_"+key+" .selectAttr.attr_"+key).attr("id"),options=[],jQuery(".optionsSelects.product_"+product_id+".compra_"+id_compra+' option:selected:not([value=""])').each(function(){parseInt(jQuery(this).closest('.selectAttr[class*="attr_"]').attr("key"))<parseInt(key)&&options.push({attr_code:jQuery(this).attr("id"),attr_id:jQuery(this).val()})}),jQuery.ajax({type:"POST",url:baseurl("comprejunto/standard/getnextfirst"),data:{attr_compra:id_compra,options:options,next_attribute:next_attribute,product_id:product_id}}).done(function(e){jQuery(produto).find('.selectAttr[class*="attr_"]').each(function(){parseInt(jQuery(this).attr("key"))>=parseInt(key)&&(jQuery(this).html(""),jQuery(this).append(new Option("Selecione...","",!0,!0)),jQuery(this).closest(".select_"+jQuery(this).attr("key")).css("display","none"))});var o=e;if(o.length>0)for(var r=0;r<o.length;r++){opc=o[r].option_next,prod_pai=o[r].prod_pai_id,nome_produto=o[r].nome_produto,filho_id=o[r].filho_id,preco_desconto=o[r].preco_desconto,preco_total_filho=o[r].preco_total_filho,imagem=o[r].imagem,admin_desconto=parseFloat(o[r].admin_desconto),admin_descontos_formated=(100-admin_desconto)/100,comprejunto_desconto=parseFloat(o[r].comprejunto_desconto),comprejunto_tipodesconto=o[r].comprejunto_tipodesconto,preco_total_filho&&select_atual.closest(".product").find("div.boxPrecoUnit p.precoindividual.config").html("R$ "+preco_total_filho.replace(".",",")),preco_desconto&&select_atual.closest(".product").find("div.boxPrecoUnit p.precoindividual2.config").html("R$ "+preco_desconto.replace(".",",")),imagem&&(imagem=imagem.replace("/","/"),jQuery(produto).find("a#"+prod_pai+" img").attr("src",imagem)),select_atual.closest(".formcomprejunto").find(".antigo span").hasClass(prod_pai)&&select_atual.closest(".formcomprejunto").find(".antigo span."+prod_pai+" span.price").html("R$ "+preco_desconto.replace(".",",")),noDiscountsTotal=0,select_atual.closest(".formcomprejunto").find(".precoindividual").each(function(){var t=jQuery(this).html().replace(/[^\d,]/g,"").replace(",",".");noDiscountsTotal+=parseFloat(t)}),soma=0,select_atual.closest(".formcomprejunto").find(".antigo span.compra_prod span.price").each(function(){var t=jQuery(this).html().replace(/[^\d,]/g,"").replace(",",".");soma+=parseFloat(t)}),soma_string=soma.toFixed(2).replace(".",","),select_atual.closest(".formcomprejunto").find(".antigo span.totalgeral span.preco b").html("R$ "+soma_string);var s=select_atual.closest(".formcomprejunto").find(".parcelaBloco span.parcela").attr("data-parcela"),a=soma/s;for(var c in select_atual.closest(".formcomprejunto").find(".parcelaBloco span.preco").html("R$ "+a.toFixed(2).replace(".",",")),preco_combinado_string=soma.toFixed(2).replace(".",","),select_atual.closest(".formcomprejunto").find(".novo b").first().html(" R$ "+preco_combinado_string),admin_desconto>0&&("porcent"==o[r].comprejunto_tipodesconto?(total_descontos=(100-(admin_desconto+comprejunto_desconto))/100,comDesc=noDiscountsTotal*total_descontos):comDesc=noDiscountsTotal*admin_descontos_formated-comprejunto_desconto,desconto_string=comDesc.toFixed(2).replace(".",","),select_atual.closest(".formcomprejunto").find(".novo b").last().html(" R$ "+desconto_string)),opc)jQuery(produto).find(".select_"+key+" .selectAttr.attr_"+key).append(t(next_attribute,id_compra,c,opc[c]));jQuery(produto).find(".select_"+key+" .selectAttr.attr_"+key).val(""),jQuery(produto).find(".select_"+key).fadeIn("slow")}else jQuery(produto).find(".select_"+key+" .selectAttr.attr_"+key).append(new Option("Selecione...","",!0,!0));jQuery(produto).find(".loadingattr").hide(),jQuery(produto).css("opacity","1")})})});