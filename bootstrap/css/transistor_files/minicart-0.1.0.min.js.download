var rtime;jQuery(document).ready(function(){jQuery("#input-coupon").live("keypress",function(e){13==e.which&&jQuery("#btn-apply-coupon").click()}),jQuery(".iconeCart").live("click",function(){return Geral.abreCarrinho(),!1}),jQuery("#btn-apply-coupon").live("click",function(){var e=Cupom.usar();!1!==e&&(Geral.showOverlay(),e.done(function(e){var r=jQuery(".outter-wrapper-cart");e.error?(Geral.hideSpinner(),Geral.mostrarMsg(e.msg)):(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideOverlay(),jQuery("#overlay").show()),Geral.calculaPosicaoItems()}).fail(function(){Geral.hideSpinner(),Geral.mostrarMsg("Erro ao adicionar cupom")}))}),jQuery("#btn-remove-coupon").live("click",function(){var e=Cupom.remover();!1!==e&&(Geral.showOverlay(),e.done(function(e){var r=jQuery(".outter-wrapper-cart");e.error?(Geral.hideSpinner(),Geral.mostrarMsg(e.msg)):(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideOverlay()),Geral.calculaPosicaoItems()}).fail(function(){Geral.hideSpinner(),Geral.mostrarMsg("Erro ao remover cupom")}))}),jQuery("#postcode_sidebar").live("keypress",function(e){13==e.which&&jQuery("#btn-estima-cep").click()}),jQuery("#btn-estima-cep").live("click",function(){var e=Frete.calcularFrete(jQuery("#postcode_sidebar").val());Frete.msg(e)}),jQuery('.outter-wrapper-cart input[name="estimate_method"]').live("click",function(){var e=Frete.calcularFrete(jQuery("#postcode_sidebar").val(),!0,jQuery("input[name=estimate_method]:checked").val());Frete.msg(e)}),jQuery(".mini-qty-dec, .mini-qty-inc").live("click",function(){var e=jQuery(this).parent().find(".mini-qty-item"),r={},a=-1===jQuery(this).prop("class").indexOf("mini-qty-dec"),t=e.val().split("#"),i=parseInt(t[1]),n=t[2],l=t[0],o=!1;if(n=null==n||""===n?"":n,a?r[l]={qty:++i,sku:n}:(o=i<=1,r[l]=i<=1?{qty:i,sku:n}:{qty:--i,sku:n}),!o){Geral.showOverlay();var u={cart:r};Geral.atualizarQuantidade(u).done(function(e){var r=jQuery(".outter-wrapper-cart");if(e.error)r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideSpinner(),Geral.mostrarMsg(e.msg);else{if(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),e.frete)Frete.calcularFrete(e.postcode,!0,e.frete).done(function(e){e.error||(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho())});Geral.hideOverlay()}})}}),jQuery(".input-text-qty").live("change",function(){var e=jQuery(this).parent().find(".mini-qty-item"),r={},a=parseInt(jQuery(this).val()),t=e.val().split("#"),i=parseInt(t[1]),n=t[2],l=a<=0;if(n=null==n||""===n?"":n,r[t[0]]={qty:a,sku:n},l)jQuery(this).val(i);else{Geral.showOverlay();var o={cart:r};Geral.atualizarQuantidade(o).done(function(e){var r=jQuery(".outter-wrapper-cart");if(e.error)r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideSpinner(),Geral.mostrarMsg(e.msg);else{if(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),e.frete)Frete.calcularFrete(e.postcode,!0,e.frete).done(function(e){e.error||(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho())});Geral.hideOverlay()}})}}),jQuery(".carrinho .btn-remove").live("click",function(){var e=jQuery(this).attr("data-cart");return Geral.removeItem(e),!1})});var timeout=!1,delta=200;function resizeend(){new Date-rtime<delta?setTimeout(resizeend,delta):(timeout=!1,Geral.calculaPosicaoItems())}jQuery(window).resize(function(){Geral.calculaPosicaoItems(),rtime=new Date,!1===timeout&&(timeout=!0,setTimeout(resizeend,delta))});var Geral={getUrlBase:function(e){return myurl=window.location,splited_url=myurl.toString().split("/"),final_url=splited_url[0]+"//"+splited_url[2],this.isLocalhost(document.location.hostname)?final_url=splited_url[0]+"//"+splited_url[2]+"/"+splited_url[3]:final_url=splited_url[0]+"//"+splited_url[2],final_url+"/"+e},isLocalhost:function(e){if("localhost"==e)return!0;exploded=e.split(".");for(var r=0;r<exploded.length;r++)if(isNaN(exploded[r]))return!1;return!0},atualizarQuantidade:function(e){return jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/atualizaQuantidade"),type:"POST",data:e})},removeItem:function(e,r){return Geral.showOverlay(),jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/removeItemCart"),type:"POST",data:{id:e},success:function(e){var r=jQuery(".outter-wrapper-cart");e.error?(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideSpinner(),Geral.mostrarMsg(e.msg)):(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideOverlay())}})},mostrarMsg:function(e,r){swal({title:"Ops...",type:"error",text:e,html:!0}),Geral.hideOverlay()},fecharMsg:function(){var e=jQuery("#msg-erro-cart");e.find(".msg-body").text(""),"block"==e.css("display")&&e.css("display","none")},fecharCarrinho:function(){jQuery(".block-cart").css("right","-100%"),jQuery("#overlay").fadeOut(),jQuery("body").removeClass("modal-open")},calculaPosicaoItems:function(){if(jQuery(".block-cart").length>0){var e=jQuery(".block-cart .head"),r=jQuery(".block-cart .gratis"),a=jQuery(".cart-sidebar-bottom"),t=jQuery(".mini-products-list"),i=jQuery(window).height()-(e.outerHeight()+r.outerHeight()+a.outerHeight());t.css({top:0,height:i-10})}},abreCarrinho:function(){jQuery(".block-cart").css("right","0"),jQuery("#overlay").show(),jQuery("body").addClass("modal-open"),Geral.calculaPosicaoItems()},showOverlay:function(){jQuery("#load-overlay").show(),jQuery(".wrapper-spinner").css("display","block")},hideOverlay:function(){jQuery("#load-overlay").hide(),jQuery(".wrapper-spinner").css("display","none")},hideSpinner:function(){var e=jQuery(".wrapper-spinner");"block"==e.css("display")&&e.css("display","none")}},Cupom={usar:function(){var e=jQuery("#input-coupon").val();return""!=e?jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/aplicarCupomMiniCart"),type:"POST",data:{coupon_code:e}}):(Geral.showOverlay(),Geral.hideSpinner(),Geral.mostrarMsg("Informe um cupom"),!1)},remover:function(){return jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/aplicarCupomMiniCart"),type:"POST",data:{remove:"1"}})}},Frete={msg:function(e){!1!==e&&(Geral.showOverlay(),e.done(function(e){var r=jQuery(".outter-wrapper-cart");e.error?(Geral.hideSpinner(),Geral.mostrarMsg(e.msg)):(r.find(".cart-mini-append").detach(),r.append(e.review),Geral.abreCarrinho(),Geral.hideOverlay()),Geral.calculaPosicaoItems()}).fail(function(){Geral.hideSpinner(),Geral.mostrarMsg("Erro ao estimar o frete")}))},calcularFrete:function(e,r,a){var t=e,i=jQuery("#country").val();if(""!==t){var n=t.replace(new RegExp("[_-]","g"),"");if(8==n.length){var l=n.length,o=n.substr(0,l-3),u=n.substr(l-3,l);return n=o+"-"+u,jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/metodoEntrega"),type:"POST",data:{cepval:n,country_id:i,update:r,estimate_method:a}})}return Geral.showOverlay(),Geral.hideSpinner(),Geral.mostrarMsg("Informe um CEP válido"),!1}return Geral.showOverlay(),Geral.hideSpinner(),Geral.mostrarMsg("Informe um CEP válido"),!1},getCodigoFreteGratis:function(){jQuery.ajax({url:Geral.getUrlBase("minicart/minicart/getFreeShippingCode"),type:"GET"}).done(function(e){return e.error?"":e.frete}).fail(function(){return""})}};